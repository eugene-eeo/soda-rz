#!/usr/bin/env python

import json
import argparse
import sys
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt


def main():
    parser = argparse.ArgumentParser(description='Plot data generated by sim')
    parser.add_argument('filename', metavar='filename', type=str,
                    help='file to plot')
    parser.add_argument('--dpi', dest='dpi', default=300, type=int,
                    help='toggle dpi of plotted figure')
    args = parser.parse_args()

    df = pd.DataFrame(columns=['level', 'damage', 'probability'])
    for i, line in enumerate(sys.stdin):
        r = json.loads(line)
        df.loc[i] = [
            int(r['l']),
            int(r['d']),
            r['p'],
        ]

    df = df.to_dense()
    df[['level', 'damage']] = df[['level', 'damage']].astype(int)
    sns.set_style('whitegrid')
    g = sns.FacetGrid(df, col='level', sharex=False, col_wrap=4)
    g.map(plt.bar, 'damage', 'probability', color='black', linewidth=0.5)
    plt.savefig(args.filename, dpi=args.dpi)


if __name__ == '__main__':
    main()
